<nav class="nav-header" role="navigation" itemscope="itemscope" itemtype="http://schema.org/SiteNavigationElement">
  <ul id="menu-main-menu" class="menu genesis-nav-menu responsive-menu">
    {% strip %}
      {% for item in site.data.main-menu %}

        {% if item.subitems != null %}
          {% assign hasSub = 'menu-item-has-children' %}
        {% else %}
          {% assign hasSub = '' %}
        {% endif %}

        {% assign cls = 'menu-item' %}
        {% if page.permalink != null %}
          {% assign testlink = page.permalink | replace: '/index.html', '' %}
          {% if testlink == item.href %}
            {% assign cls = 'menu-item current-menu-item' %}
          {% endif %}
        {% endif %}

        <li class="{{ cls }} {{ hasSub }}">
          {% if item.href == null %}
            {{ item.title }}
          {% else %}
            <a href="{{ item.href | prepend: site.baseurl }}">{{ item.title }}</a>
          {% endif %}
          {% if item.subitems != null %}
            <ul class="sub-menu">
              {% for subitem in item.subitems %}

                {% assign subcls = 'menu-item' %}
                {% if page.permalink != null %}
                  {% assign testlink = page.permalink | replace: '/index.html', '' %}
                  {% if testlink == subitem.href %}
                    {% assign subcls = 'menu-item current-menu-item' %}
                  {% endif %}
                {% endif %}

                <li class="{{ subcls }}">
                  <a href="{{ subitem.href | prepend: site.baseurl }}">{{ subitem.title }}</a>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </li>
      {% endfor %}
    {% endstrip %}
  </ul>
</nav>
